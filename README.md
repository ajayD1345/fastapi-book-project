# FastAPI Book Management API

## Overview

This project is a RESTful API built with FastAPI for managing a book collection. It provides comprehensive CRUD (Create, Read, Update, Delete) operations with robust input validation, error handling, and API documentation.

## Task Overview

This project was developed as part of the **DevOps Stage 2 Task**, which required deploying a FastAPI application with a CI/CD pipeline. The key deliverables included:

- âœ… Implementing missing API endpoints
- âœ… Setting up a **CI/CD pipeline** for automated deployment
- âœ… Dockerizing the application
- âœ… Deploying the API with **Nginx as a reverse proxy**
- âœ… Running the application on a **publicly accessible server**

## Features

- ğŸ“š Book management (CRUD operations)
- âœ… Input validation using Pydantic models
- ğŸ” Enum-based genre classification
- ğŸ§ª Complete test coverage with `pytest`
- ğŸš€ Dockerized for easy deployment
- ğŸ”„ CI/CD pipeline for automated deployment
- ğŸ”’ Nginx reverse proxy setup
- ğŸ“ API documentation auto-generated by FastAPI
- ğŸŒ Deployed to a cloud server with **public access**

## Project Structure

```
fastapi-book-project/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ schemas.py      # Data models and in-memory database
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ books.py        # Book route handlers
â”‚   â””â”€â”€ router.py           # API router configuration
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ config.py           # Application settings
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_books.py       # API endpoint tests
â”œâ”€â”€ main.py                 # Application entry point
â”œâ”€â”€ Dockerfile              # Docker containerization
â”œâ”€â”€ nginx.conf              # Nginx configuration for reverse proxy
â”œâ”€â”€ requirements.txt        # Project dependencies
â”œâ”€â”€ .github/workflows/      # CI/CD pipeline configuration
â””â”€â”€ README.md
```

## Technologies Used

- **Python 3.12**
- **FastAPI**
- **Pydantic**
- **pytest**
- **Docker & Docker Compose**
- **Nginx** (Reverse Proxy)
- **GitHub Actions** (CI/CD)
- **Uvicorn**

## Installation & Local Setup

1. **Clone the repository:**

   ```bash
   git clone https://github.com/hng12-devbotops/fastapi-book-project.git
   cd fastapi-book-project
   ```

2. **Create a virtual environment:**

   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. **Install dependencies:**

   ```bash
   pip install -r requirements.txt
   ```

4. **Run the application locally:**

   ```bash
   uvicorn main:app --reload
   ```

5. **Access API documentation:**
   - Swagger UI: [http://localhost:8000/docs](http://localhost:8000/docs)
   - ReDoc: [http://localhost:8000/redoc](http://localhost:8000/redoc)

## Deployment Process

### **1ï¸âƒ£ Build and Push Docker Image**
```bash
docker build -t <your-dockerhub-username>/fastapi-app:latest .
docker login
docker push <your-dockerhub-username>/fastapi-app:latest
```

### **2ï¸âƒ£ Run the Container on the Server**
```bash
docker run -d --name fastapi-app -p 8000:8000 <your-dockerhub-username>/fastapi-app:latest
```

### **3ï¸âƒ£ Configure Nginx as a Reverse Proxy**
- Nginx is set up to forward traffic from port **80** to the FastAPI app running on **port 8000**.
- The `nginx.conf` file is configured as follows:

```nginx
server {
    listen 80;
    server_name <your-server-ip>;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### **4ï¸âƒ£ Restart Nginx**
```bash
sudo systemctl restart nginx
```

### **5ï¸âƒ£ Verify the Deployment**

- Visit `http://<your-server-ip>/docs` to check the API documentation.
- Run a health check:
  ```bash
  curl http://<your-server-ip>/healthcheck
  ```

## API Endpoints

### **Books**

- `GET /api/v1/books/` - Get all books
- `GET /api/v1/books/{book_id}` - Get a specific book
- `POST /api/v1/books/` - Create a new book
- `PUT /api/v1/books/{book_id}` - Update a book
- `DELETE /api/v1/books/{book_id}` - Delete a book

### **Health Check**

- `GET /healthcheck` - Check API status

## Book Schema Example

```json
{
  "id": 1,
  "title": "Book Title",
  "author": "Author Name",
  "publication_year": 2024,
  "genre": "Fantasy"
}
```

Available genres:
- Science Fiction
- Fantasy
- Horror
- Mystery
- Romance
- Thriller

## Running Tests

```bash
pytest
```

## Error Handling

The API includes proper error handling for:

- Non-existent books
- Invalid book IDs
- Invalid genre types
- Malformed requests

## CI/CD Pipeline

This project uses **GitHub Actions** for CI/CD. The workflow:

1. **Triggers** on every `push` to `main`.
2. **Builds** the Docker image.
3. **Runs unit tests** with `pytest`.
4. **Pushes the image** to Docker Hub.
5. **Deploys the container** on the cloud server.

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit changes (`git commit -m 'Add AmazingFeature'`)
4. Push to branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Support

For support, please open an issue in the GitHub repository.

